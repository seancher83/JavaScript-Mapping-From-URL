<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <title>Google Maps Multiple Markers</title>
  <script src="https://maps.googleapis.com/maps/api/geocode/outputFormat?parameters"
          type="text/javascript"></script>
  <script src="http://maps.google.com/maps/api/js?sensor=false"
          type="text/javascript"></script>
</head>
<body>
  <div id="map" style="width: 1150px; height: 725px;"></div>
    <script type="text/javascript">

      "Load Queries from URL.  I set up the database to push through query information embedded in the url.  This one didn't work in Filemaker pro.  I assume it is because we are using an old version of Filemaker and the webbrowser does not support searchParams which I read is newer functionality."
      //var searchParams = new URLSearchParams(window.location.search);
      //var address = searchParams.get('addressOne');

      
      //Load queries from URL using regular expressions.
      function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      }

      //Find the number of parameters in the URL
      var url = window.location.href;
      var splitAtEqualSign = url.split('=');
      //Have to drop one from the count in order to account for the base url
      var parameterCount = splitAtEqualSign.length - 1;
      console.log(parameterCount);


      //Create Map
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 9,
        center: new google.maps.LatLng(47.43, -122.26),
        mapTypeId: google.maps.MapTypeId.ROADMAP
      });

      //Convert addresses to lat/long then create Markers and add to map
      var infowindow = new google.maps.InfoWindow();
      var marker, i;
      var geocoder = new google.maps.Geocoder();

      for (addressLocation = 1; addressLocation <= parameterCount ; addressLocation++){
        var address = getParameterByName('address' + addressLocation);
        geocoder.geocode( { 'address':address}, function(results, status) {
          if (status == google.maps.GeocoderStatus.OK){
            var marker = new google.maps.Marker({
              map: map,
              position: results[0].geometry.location
            })
            google.maps.event.addListener(marker, 'click', (function(marker, i) {
            return function() {
              infowindow.setContent('Mark Content Here');
              infowindow.open(map, marker);
            }
          })(marker, i));
        }
        });
      }
    </script>
</body>
</html>
